---
title: ä¼ä¸šçº§æœ€ä½³å®è·µ02
date: 2021-02-19
tags:
 - react
categories:
 - react
sidebar: 'auto'
---

### **æœ¬èŠ‚é‡ç‚¹**
::: warning
1. æŒæ¡ä¼ä¸šçº§åº”ç”¨æ¡†æ¶ - umi
2. æŒæ¡æ•°æ®æµæ–¹æ¡ˆ - dva
:::

## èµ„æº
1. [umi](https://umijs.org/zh-CN/docs)
2. [dva](https://dvajs.com/)
3. [Why dva and what's dva](https://dvajs.com/)
4. [Antd Pro](https://pro.ant.design/docs/getting-started-cn)

## dva
dva é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº [redux](https://github.com/reduxjs/redux) å’Œ [redux-saga](https://github.com/redux-saga/redux-saga) çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva è¿˜é¢å¤–å†…ç½®äº†
[react-router](https://github.com/ReactTraining/react-router) å’Œ [fetch](https://github.com/github/fetch)ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚

### dvaç‰¹æ€§
- **æ˜“å­¦æ˜“ç”¨**ï¼Œä»…æœ‰ 6 ä¸ª apiï¼Œå¯¹ redux ç”¨æˆ·å°¤å…¶å‹å¥½ï¼Œé…åˆ [umi](https://umijs.org/guide/with-dva.html) ä½¿ç”¨åæ›´æ˜¯é™ä½ä¸º 0 API
- **elm æ¦‚å¿µ**ï¼Œé€šè¿‡ reducers, effects å’Œ subscriptions ç»„ç»‡ model
- **æ’ä»¶æœºåˆ¶**ï¼Œæ¯”å¦‚ [dva-loading](https://github.com/dvajs/dva/tree/master/packages/dva-loading) å¯ä»¥è‡ªåŠ¨å¤„ç† loading çŠ¶æ€ï¼Œä¸ç”¨ä¸€ééåœ°å†™ showLoading å’Œ hideLoading
- **æ”¯æŒ HMRï¼ˆæ¨¡å—çƒ­æ›¿æ¢ï¼‰**ï¼ŒåŸºäº [babel-plugin-dva-hmr](https://github.com/dvajs/babel-plugin-dva-hmr) å®ç° componentsã€routes å’Œ models çš„ HMRã€‚

### dvaæ•°æ®æµå‘
æ•°æ®çš„æ”¹å˜å‘ç”Ÿé€šå¸¸æ˜¯é€šè¿‡ç”¨æˆ·äº¤äº’è¡Œä¸ºæˆ–è€…æµè§ˆå™¨è¡Œä¸ºï¼ˆå¦‚è·¯ç”±è·³è½¬ç­‰ï¼‰è§¦å‘çš„ï¼Œå½“æ­¤ç±»è¡Œä¸ºä¼šæ”¹å˜æ•°æ®çš„æ—¶å€™å¯ä»¥é€šè¿‡ dispatch å‘èµ·ä¸€ä¸ª actionï¼Œå¦‚æœæ˜¯åŒæ­¥è¡Œä¸ºä¼šç›´æ¥é€šè¿‡ Reducers æ”¹å˜ Stateï¼Œå¦‚æœæ˜¯å¼‚æ­¥è¡Œä¸ºï¼ˆå‰¯ä½œç”¨ï¼‰ä¼šå…ˆè§¦å‘ Effects ç„¶åæµå‘ Reducers æœ€ç»ˆæ”¹å˜ State ï¼Œæ‰€ä»¥åœ¨ dvaä¸­ï¼Œæ•°æ®æµå‘éå¸¸æ¸…æ™°ç®€æ˜ï¼Œå¹¶ä¸”æ€è·¯åŸºæœ¬è·Ÿå¼€æºç¤¾åŒºä¿æŒä¸€è‡´ï¼ˆä¹Ÿæ˜¯æ¥è‡ªäºå¼€æºç¤¾åŒºï¼‰
![æ•°æ®æµå‘å›¾](/react/6.png)

### ç†è§£dva
**è½¯ä»¶åˆ†å±‚**ï¼šå›é¡¾reactï¼Œä¸ºäº†è®©æ•°æ®æµæ›´æ˜“äºç»´æŠ¤ï¼Œæˆ‘ä»¬åˆ†æˆäº†storeï¼Œreducerï¼Œactionç­‰æ¨¡å—ï¼Œå„å¸å…¶èŒï¼Œè½¯ä»¶å¼€å‘ä¹Ÿæ˜¯ä¸€æ ·

1. Page è´Ÿè´£ä¸ç”¨æˆ·ç›´æ¥æ‰“äº¤é“ï¼šæ¸²æŸ“é¡µé¢ã€æ¥å—ç”¨æˆ·çš„æ“ä½œè¾“å…¥ï¼Œä¾§é‡äº å±•ç¤ºå‹äº¤äº’æ€§é€»è¾‘ ã€‚
2. Model è´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¸º Page åšæ•°æ®ã€çŠ¶æ€çš„è¯»å†™ã€å˜æ¢ã€æš‚å­˜ç­‰ã€‚
3. Service è´Ÿè´£ä¸ HTTP æ¥å£å¯¹æ¥ï¼Œè¿›è¡Œçº¯ç²¹çš„æ•°æ®è¯»å†™ã€‚

DVA æ˜¯åŸºäº reduxã€redux-saga å’Œ react-router çš„è½»é‡çº§å‰ç«¯æ¡†æ¶åŠæœ€ä½³å®è·µæ²‰æ·€ï¼Œæ ¸å¿ƒapiå¦‚ä¸‹ï¼š

1. model
    - state çŠ¶æ€
    - action
    - dispatch
    - reducer
    - effect å‰¯ä½œç”¨ï¼Œå¤„ç†å¼‚æ­¥
2. subscriptions è®¢é˜…
3. router è·¯ç”±

> 1. namespace ï¼šmodel çš„å‘½åç©ºé—´ï¼Œåªèƒ½ç”¨å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå¤§å‹åº”ç”¨å¯èƒ½åŒ…å«å¤šä¸ª modelï¼Œé€šè¿‡ namespace åŒºåˆ†
> 2. reducers ï¼šç”¨äºä¿®æ”¹ state ï¼Œç”± action è§¦å‘ã€‚reducer æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒæ¥å—å½“å‰çš„state åŠä¸€ä¸ª action å¯¹è±¡ã€‚action å¯¹è±¡é‡Œé¢å¯ä»¥åŒ…å«æ•°æ®ä½“ï¼ˆpayloadï¼‰ä½œä¸ºå…¥å‚ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„ stateã€‚
> 3. effects ï¼šç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼ˆä¾‹å¦‚ï¼šä¸æœåŠ¡ç«¯äº¤äº’ï¼‰å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿæ˜¯ç”± action è§¦å‘ã€‚ä½†æ˜¯ï¼Œå®ƒä¸å¯ä»¥ä¿®æ”¹ stateï¼Œè¦é€šè¿‡è§¦å‘ action è°ƒç”¨ reducer å®ç°å¯¹ state çš„é—´æ¥æ“ä½œã€‚
> 4. action ï¼šæ˜¯ reducers åŠ effects çš„è§¦å‘å™¨ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå½¢å¦‚ { type: 'add',payload: todo } ï¼Œé€šè¿‡ type å±æ€§å¯ä»¥åŒ¹é…åˆ°å…·ä½“æŸä¸ª reducer æˆ–è€… effectï¼Œpayload å±æ€§åˆ™æ˜¯æ•°æ®ä½“ï¼Œç”¨äºä¼ é€ç»™ reducer æˆ– effectã€‚

### åˆ‡æ¢ history ä¸º browserHistory
å…ˆå®‰è£… history ä¾èµ–ï¼Œ
```bash
$ npm install --save history
```
ç„¶åä¿®æ”¹å…¥å£æ–‡ä»¶app.jsï¼Œ
```js
const createHistory = require("history").createBrowserHistory;
const app = dva({
  history: createHistory()
});
```
ç›®å‰ç‰ˆæœ¬ä¸­é”™è¯¯å¤„ç†ï¼š
![é”™è¯¯å¤„ç†](/react/7.png)

æ‰“å¼€node_modules/dva/lib/index/jsï¼š  
æ‰¾åˆ°
```js
var _createHashHistory = _interopRequireDefault(require("history/createHashHistory"));
```
æ”¹æˆï¼š
```js
var _createHashHistory = _interopRequireDefault(require("history").createHashHistory);
```
githubå¯¹åº”issueï¼š[https://github.com/dvajs/dva/issues/2115](https://github.com/dvajs/dva/issues/2115)

### dynamic
dynamic/index.js
```js
import dynamic from "dva/dynamic";
import app from "../app";
export const UserPageDynamic = dynamic({
  app,
  models: () => [import("../models/user")],
  component: () => import("../routes/UserPage")
});
```
### ExamplePage
```jsx
import React, { Component } from "react";
import { connect } from "dva";
import { Button, Table } from "antd";
import { Link } from "dva/router";
import { routerRedux } from "dva/router";
import styles from "./ExamplePage.less";
const columns = [
  {
    title: "å§“å",
    dataIndex: "name",
    key: "name"
  },
  {
    title: "å¹´é¾„",
    dataIndex: "age",
    key: "age"
  },
  {
    title: "ä½å€",
    dataIndex: "city",
    key: "city"
  }
];
@connect(
  state => ({ state, example: state.example }),
  dispatch => {
    return {
      dispatch,
      getProductData: payload =>
      dispatch({ type: "example/getProductData", payload })
    };
  }
)
class ExamplePage extends Component {
  dataSearch = () => {
    // å¼‚æ­¥è·å–æ•°æ®
    this.props.getProductData();
  };
  render() {
    console.log("ExamplePage props", this.props); //sy-log
    const { example, dispatch } = this.props;
    const { data } = example;
    return (
      <div className={styles.example}>
        <h3 className={styles.title}>ExamplePage</h3>
        <button onClick={this.dataSearch}>search</button>
        <Table columns={columns} dataSource={data} rowKey="id" />
        <Link to="/user">go userPage</Link>
        <Link to="/">é¦–é¡µ</Link>
        <Button
          onClick={() => {
          dispatch(routerRedux.push("/"));
          }}
          >
          go index
        </Button>
      </div>
    );
  }
}
export default ExamplePage;
```

## umi
### å®šä¹‰
umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ä¼ä¸šçº§ react åº”ç”¨æ¡†æ¶ã€‚

### why umi
å®ƒä¸»è¦å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š
  - ğŸ‰ å¯æ‰©å±•ï¼ŒUmi å®ç°äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä½¿å…¶æ’ä»¶åŒ–ï¼ŒUmi å†…éƒ¨åŠŸèƒ½ä¹Ÿå…¨ç”±æ’ä»¶å®Œæˆã€‚æ­¤å¤–è¿˜æ”¯æŒæ’ä»¶å’Œæ’ä»¶é›†ï¼Œä»¥æ»¡è¶³åŠŸèƒ½å’Œå‚ç›´åŸŸçš„åˆ†å±‚éœ€æ±‚ã€‚
  - ğŸ“¦ å¼€ç®±å³ç”¨ï¼ŒUmi å†…ç½®äº†è·¯ç”±ã€æ„å»ºã€éƒ¨ç½²ã€æµ‹è¯•ç­‰ï¼Œä»…éœ€ä¸€ä¸ªä¾èµ–å³å¯ä¸Šæ‰‹å¼€å‘ã€‚å¹¶ä¸”è¿˜æä¾›é’ˆå¯¹ React çš„é›†æˆæ’ä»¶é›†ï¼Œå†…æ¶µä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¯æ»¡è¶³æ—¥å¸¸ 80% çš„å¼€å‘éœ€æ±‚ã€‚
  - ğŸ  ä¼ä¸šçº§ï¼Œç»èš‚èšå†…éƒ¨ 3000+ é¡¹ç›®ä»¥åŠé˜¿é‡Œã€ä¼˜é…·ã€ç½‘æ˜“ã€é£çŒªã€å£ç¢‘ç­‰å…¬å¸é¡¹ç›®çš„éªŒè¯ï¼Œå€¼å¾—ä¿¡èµ–ã€‚
  - ğŸš€ å¤§é‡è‡ªç ”ï¼ŒåŒ…å«å¾®å‰ç«¯ã€ç»„ä»¶æ‰“åŒ…ã€æ–‡æ¡£å·¥å…·ã€è¯·æ±‚åº“ã€hooks åº“ã€æ•°æ®æµç­‰ï¼Œæ»¡è¶³æ—¥å¸¸é¡¹ç›®çš„å‘¨è¾¹éœ€æ±‚ã€‚
  - ğŸŒ´ å®Œå¤‡è·¯ç”±ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼ŒåŒæ—¶ä¿æŒåŠŸèƒ½çš„å®Œå¤‡æ€§ï¼Œæ¯”å¦‚åŠ¨æ€è·¯ç”±ã€åµŒå¥—è·¯ç”±ã€æƒé™è·¯ç”±ç­‰ç­‰ã€‚
  - ğŸš„ é¢å‘æœªæ¥ï¼Œåœ¨æ»¡è¶³éœ€æ±‚çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šåœæ­¢å¯¹æ–°æŠ€æœ¯çš„æ¢ç´¢ã€‚æ¯”å¦‚ dll æé€Ÿã€modernmodeã€webpack@5ã€è‡ªåŠ¨åŒ– externalã€bundler less ç­‰ç­‰ã€‚

### ä»€ä¹ˆæ—¶å€™ä¸ç”¨ umiï¼Ÿ
å¦‚æœä½ ï¼Œ
  - éœ€è¦æ”¯æŒ IE 8 æˆ–æ›´ä½ç‰ˆæœ¬çš„æµè§ˆå™¨
  - éœ€è¦æ”¯æŒ React 16.8.0 ä»¥ä¸‹çš„ React
  - éœ€è¦è·‘åœ¨ Node 10 ä»¥ä¸‹çš„ç¯å¢ƒä¸­
  - æœ‰å¾ˆå¼ºçš„ webpack è‡ªå®šä¹‰éœ€æ±‚å’Œä¸»è§‚æ„æ„¿
  - éœ€è¦é€‰æ‹©ä¸åŒçš„è·¯ç”±æ–¹æ¡ˆ

Umi å¯èƒ½ä¸é€‚åˆä½ ã€‚

### ä¸ºä»€ä¹ˆä¸æ˜¯ï¼Ÿ
[create-react-app](https://github.com/facebook/create-react-app)  
create-react-app æ˜¯åŸºäº webpack çš„æ‰“åŒ…å±‚æ–¹æ¡ˆï¼ŒåŒ…å« buildã€devã€lint ç­‰ï¼Œä»–åœ¨æ‰“åŒ…å±‚æŠŠä½“éªŒåšåˆ°äº†æè‡´ï¼Œä½†æ˜¯ä¸åŒ…å«è·¯ç”±ï¼Œä¸æ˜¯æ¡†æ¶ï¼Œä¹Ÿä¸æ”¯æŒé…ç½®ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¤§å®¶æƒ³åŸºäºä»–ä¿®æ”¹éƒ¨åˆ†é…ç½®ï¼Œæˆ–è€…å¸Œæœ›åœ¨æ‰“åŒ…å±‚ä¹‹å¤–ä¹ŸåšæŠ€æœ¯æ”¶æ•›æ—¶ï¼Œå°±ä¼šé‡åˆ°å›°éš¾ã€‚

[next.js](https://github.com/vercel/next.js)  
next.js æ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼ŒUmi å¾ˆå¤šåŠŸèƒ½æ˜¯å‚è€ƒ next.js åšçš„ã€‚è¦è¯´æœ‰å“ªäº›åœ°æ–¹ä¸å¦‚ Umiï¼Œæˆ‘è§‰å¾—å¯èƒ½æ˜¯ä¸å¤Ÿè´´è¿‘ä¸šåŠ¡ï¼Œä¸å¤Ÿæ¥åœ°æ°”ã€‚æ¯”å¦‚ antdã€dva çš„æ·±åº¦æ•´åˆï¼Œæ¯”å¦‚å›½é™…åŒ–ã€æƒé™ã€æ•°æ®æµã€é…ç½®å¼è·¯ç”±ã€è¡¥ä¸æ–¹æ¡ˆã€è‡ªåŠ¨åŒ– external æ–¹é¢ç­‰ç­‰ä¸€çº¿å¼€å‘è€…æ‰ä¼šé‡åˆ°çš„é—®é¢˜ã€‚

## Umi+DvaåŸºæœ¬ä½¿ç”¨
### å®‰è£…
ç¯å¢ƒè¦æ±‚ï¼š nodeç‰ˆæœ¬>=10.13
```bash
æ–°å»ºç«‹ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼šmkdir lesson6-umi
è¿›å…¥æ–‡ä»¶å¤¹ï¼šcd lesson6-umi
åˆ›å»ºï¼šyarn create @umijs/umi-app
å®‰è£…ä¾èµ–ï¼š yarn
å¯åŠ¨ï¼šyarn start
```
### ç›®å½•ç»“æ„
![ç›®å½•ç»“æ„](/react/8.png)

### src/.umi
ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚å…¥å£æ–‡ä»¶ã€è·¯ç”±ç­‰ï¼Œéƒ½ä¼šè¢«ä¸´æ—¶ç”Ÿæˆåˆ°è¿™é‡Œã€‚**ä¸è¦æäº¤ .umi ç›®å½•åˆ° git ä»“åº“ï¼Œä»–ä»¬ä¼šåœ¨ umi dev å’Œ umi build æ—¶è¢«åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆã€‚**

### src/app.ts
è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰©å±•è¿è¡Œæ—¶çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ä¿®æ”¹è·¯ç”±ã€ä¿®æ”¹ render æ–¹æ³•ç­‰ã€‚

### è·¯ç”±
æ‰‹åŠ¨åˆ›å»ºæˆ–è€…ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚  
å»ºç«‹pagesä¸‹é¢çš„å•é¡µé¢aboutï¼š  
```bash
npx umi g page about
```
å»ºç«‹æ–‡ä»¶å¤¹more(é»˜è®¤æ˜¯jså’Œcss)ï¼š
```bash
npx umi g page more/index --typescript --less
```
> è®¿é—®index: [http://localhost:8000/](http://localhost:8000/)  
> è®¿é—®about: [http://localhost:8000/about](http://localhost:8000/about)

#### é…ç½®è·¯ç”±
è·¯ç”±é…ç½®è¯¦ç»†æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š[https://umijs.org/zh-CN/docs/routing](https://umijs.org/zh-CN/docs/routing)

### çº¦å®šå¼è·¯ç”±
åŠ¨æ€è·¯ç”±
```bash
npx umi g page product/[id]
```
```jsx
import React from 'react';
import { IRouteComponentProps } from 'umi';
import styles from './[id].less';
export default (props: IRouteComponentProps) => {
  console.log('product', props); //sy-log
  return (
    <div>
      <h1 className={styles.title}>Page product/[id]</h1>
    </div>
  );
};
```
è·¯ç”±é…ç½®
```js
{ path: '/product/:id', component: '@/pages/product/[id]' },
```
å¯é€‰çš„åŠ¨æ€è·¯ç”±

**umi3æš‚ä¸æ”¯æŒ**ï¼Œä¸‹é¢æ˜¯umi2çš„ä½¿ç”¨ã€‚

umi é‡Œçº¦å®šåŠ¨æ€è·¯ç”±å¦‚æœå¸¦ $ åç¼€ï¼Œåˆ™ä¸ºå¯é€‰åŠ¨æ€è·¯ç”±ã€‚

npx umi g page product/'$id$'

æ¯”å¦‚ä»¥ä¸‹ç»“æ„ï¼š
```jsx
export default function({ location, match }) {
  const { id } = match.params;
  return (
    <div className={styles.normal}>
      <h1>Page $id$</h1>
      <p>{id || 'æ²¡æœ‰id'}</p>
    </div>
  );
}
```
è·¯ç”±é…ç½®ï¼š  
```js
{
  path: '/channel/:id?',
  component: './channel/$id$',
},
```
#### åµŒå¥—è·¯ç”±
Umi é‡Œçº¦å®šç›®å½•ä¸‹æœ‰ _layout.tsx æ—¶ä¼šç”ŸæˆåµŒå¥—è·¯ç”±ï¼Œä»¥ _layout.tsx ä¸ºè¯¥ç›®å½•çš„ layoutã€‚layoutæ–‡ä»¶éœ€è¦è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡ props.children æ¸²æŸ“å­ç»„ä»¶ã€‚

é¦–å…ˆåˆ›å»º_layout.js
```bash
npx umi g page product/_layout
```
```jsx
import React from 'react';
import { IRouteComponentProps } from 'umi';
export default (props: IRouteComponentProps) => {
  console.log('product', props); //sy-log
  return (
    <div style={{ color: 'red' }}>
      <h1>layout</h1>
      {props.children}
    </div>
  );
};
```
é…ç½®è·¯ç”±ï¼š
```js
{
  path: '/product/:id',
  component: '@/pages/product/_layout',
  routes: [{ path: '/product/:id', component: '@/pages/product/[id]' }],
},
```
å…¨å±€ layout

çº¦å®š src/layouts/index.tsx ä¸ºå…¨å±€è·¯ç”±ã€‚è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡ props.children æ¸²æŸ“å­ç»„ä»¶ã€‚æ¯”å¦‚ï¼š
```js
import * as React from 'react';
import { IRouteComponentProps } from 'umi';
export default function Layout({ children }: IRouteComponentProps) {
  return (
    <div style={{ color: 'orange' }}>
      <h1>å…¨å±€layout</h1>
      {children}
    </div>
  );
}
```
è·¯ç”±é…ç½®ï¼š
```jsx
import { defineConfig } from 'umi';
export default defineConfig({
  nodeModulesTransform: {
    type: 'none',
  },
  routes: [
    {
      path: '/',
      component: '@/layout/index',
      routes: [
        { path: '/', component: '@/pages/index' },
        { path: '/about', component: '@/pages/about' },
        { path: '/more', component: '@/pages/more/index' },
        // { path: '/product/:id', component: '@/pages/product/[id]' },
        {
          path: '/product/:id',
          component: '@/pages/product/_layout',
          routes: [{ path: '/product/:id', component: '@/pages/product/[id]' }],
        },
      ],
    },
  ],
});
```
ä¸åŒçš„å…¨å±€ layout

ä½ å¯èƒ½éœ€è¦é’ˆå¯¹ä¸åŒè·¯ç”±è¾“å‡ºä¸åŒçš„å…¨å±€ layoutï¼ŒUmi ä¸æ”¯æŒè¿™æ ·çš„é…ç½®ï¼Œä½†ä½ ä»å¯ä»¥åœ¨`src/layouts/index.tsx` ä¸­å¯¹ `location.path` åšåŒºåˆ†ï¼Œæ¸²æŸ“ä¸åŒçš„ `layout` ã€‚

æ¯”å¦‚æƒ³è¦é’ˆå¯¹ `/login` è¾“å‡ºç®€å•å¸ƒå±€ï¼Œ
```jsx
export default function(props) {
  if (props.location.pathname === '/login') {
    return <SimpleLayout>{ props.children }</SimpleLayout>
  }
  return (
    <>
      <Header />
        { props.children }
      <Footer />
    </>
  );
}
```
#### 404 è·¯ç”±
çº¦å®š src/pages/404.tsx ä¸º 404 é¡µé¢ï¼Œéœ€è¿”å› React ç»„ä»¶ã€‚
```bash
npx umi g page 404/index --typescript --less
```
```js
{ component: '@/pages/404' },
```
#### æ‰©å±•è·¯ç”±å±æ€§
æ”¯æŒåœ¨ä»£ç å±‚é€šè¿‡å¯¼å‡ºé™æ€å±æ€§çš„æ–¹å¼æ‰©å±•è·¯ç”±ã€‚

æ¯”å¦‚ï¼š
```jsx
function HomePage() {
  return <h1>Home Page</h1>;
}
HomePage.title = 'Home Page';
export default HomePage;
```
å…¶ä¸­çš„ title ä¼šé™„åŠ åˆ°è·¯ç”±é…ç½®ä¸­ã€‚

### åœ¨é¡µé¢é—´è·³è½¬
åœ¨ umi é‡Œï¼Œé¡µé¢ä¹‹é—´è·³è½¬æœ‰ä¸¤ç§æ–¹å¼ï¼šå£°æ˜å¼å’Œå‘½ä»¤å¼ã€‚

#### å£°æ˜å¼
é€šè¿‡ Link ä½¿ç”¨ï¼Œé€šå¸¸ä½œä¸º React ç»„ä»¶ä½¿ç”¨ã€‚
```jsx
import { Link } from 'umi';
export default () => (
  <Link to="/list">Go to list page</Link>
);
```
#### å‘½ä»¤å¼
é€šè¿‡ history ä½¿ç”¨ï¼Œé€šå¸¸åœ¨äº‹ä»¶å¤„ç†ä¸­è¢«è°ƒç”¨ã€‚
```jsx
import { history } from 'umi';
function goToListPage() {
  history.push('/list');
}
```
ä¹Ÿå¯ä»¥ç›´æ¥ä»ç»„ä»¶çš„å±æ€§ä¸­å–å¾— history
```jsx
export default (props) => (
  <Button onClick={()=>props.history.push('/list');}>Go to list page</Button>
);
```
æ›´å¤šå‘½ä»¤å¼çš„è·³è½¬æ–¹æ³•ï¼Œè¯¦è§ [api#history](https://umijs.org/zh/api#history)ã€‚

### ä½¿ç”¨æŒ‰éœ€åŠ è½½
#### æŒ‰éœ€åŠ è½½ç»„ä»¶
é€šè¿‡ Umi çš„ dynamic æ¥å£å®ç°ï¼Œæ¯”å¦‚ï¼š
```jsx
import { dynamic } from 'umi';
const delay = (timeout) => new Promise(resolve => setTimeout(resolve, timeout));
const App = dynamic({
  loader: async function() {
    await delay(/* 1s */1000);
    return () => <div>I will render after 1s</div>;
  },
});
```
#### æŒ‰éœ€åŠ è½½éç»„ä»¶
é€šè¿‡ import() å®ç°ï¼Œæ¯”å¦‚ï¼š
```jsx
import('g2').then(() => {
  // do something with g2
});
```
## å®ä¾‹
å®ç°å¦‚ä¸‹å›¾ï¼š
![å®ç°å›¾](/react/9.png)

### ä½¿ç”¨çŠ¶æ€ï¼šstate + connect
åˆ›å»ºé¡µé¢more.jsï¼š npx umi g page more/index --less

```jsx
import React from 'react';
import { PageHeaderWrapper } from '@ant-design/pro-layout';
import { Form, Input, Button, Card, Table } from 'antd';
import { connect } from 'umi';
import styles from './index.less';
const columns = [
  {
    title: 'å§“å',
    dataIndex: 'name',
    key: 'name',
  },
  {
    title: 'å¹´é¾„',
    dataIndex: 'age',
    key: 'age',
  },
  {
    title: 'ä½å€',
    dataIndex: 'city',
    key: 'city',
  },
];
// UIå±‚å’Œæ•°æ®å±‚åˆ†å¼€
class More extends React.Component {
  constructor(props) {
    super(props);
    this.state = {};
  }
  componentDidMount() {
    this.props.getProductData({ name: '' });
  }
  // æˆåŠŸæ‰ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°
  onFinish = values => {
    console.log('values', values); // sy-log
    // this.props.getMoreDataBySearch(values);
    this.props.getProductData(values);
  };
  // å¤±è´¥æ‰ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°
  onFinishFailed = err => {
    console.log('err', err); // sy-log
  };
  render() {
  const { data } = this.props.more;
  return (
    <PageHeaderWrapper className={styles.more}>
      <Card>
        <Form onFinish={this.onFinish} onFinishFailed={this.onFinishFailed}>
          <Form.Item
            label="å§“å"
            name="name"
            rules={[{ required: true, message: 'è¯·è¾“å…¥å§“å' }]}
            >
            <Input placeholder="è¯·è¾“å…¥å§“å" />
          </Form.Item>
          <Form.Item>
            <Button type="primary" htmlType="submit">
              æŸ¥è¯¢
            </Button>
          </Form.Item>
        </Form>
      </Card>
      <Card>
        <Table columns={columns} dataSource={data} rowKey="id" />
      </Card>
    </PageHeaderWrapper>
    );
  }
}
export default connect(
  // mapStateToProps
  ({ more }) => ({ more }),
  // mapDispatchToProps
  {
    getProductData: values => ({
      type: 'more/getProductData',
      payload: values,
    }),
    // getMoreDataBySearch: values => ({
    //   type: 'more/getMoreDataBySearch',
    //   payload: values,
    // }),
  },
)(More);
```
#### æ›´æ–°æ¨¡å‹src/models/more.js
```jsx
import { getProductData } from '../services/product';
export default {
  namespace: 'more',
  state: {
    data: [],
    pageSize: 10,
    current: 1,
    total: 0,
  },
  effects: {
    *getProductData({ payload }, { call, put }) {
      //
      const res = yield call(getProductData, payload);
      yield put({ type: 'productData', payload: res.data });
    },
  },
  reducers: {
    productData(state, action) {
      return { ...state, data: action.payload.data };
    },
  },
};
```

#### æ·»åŠ æœåŠ¡ï¼šservice
```jsx
import request from '@/utils/request';
export async function getChannelData(params) {
  return request('/api/getChannelData', {
    data: params,
    method: 'post',
  });
}
export async function getChannelDataBySearch(params) {
  return request('/api/getChannelDataBySearch', {
    method: 'post',
    data: params,
  });
}
```
#### æ•°æ®mockï¼šæ¨¡æ‹Ÿæ•°æ®æ¥å£
mockç›®å½•å’Œsrcå¹³çº§ï¼Œæ–°å»ºmock/product.js
```jsx
const productTableData = [];
for (let i = 0; i < 10; i++) {
  productTableData.push({
    id: i,
    name: "åå­—" + i,
    age: i,
    city: "åŸå¸‚" + i
  });
}
let total = 101;
function searchProductData({ name = "", ...pagination }) {
  console.log("pagination", pagination); //sy-log
  const res = [];
  let pageSize = pagination.pageSize || 10;
  let current = pagination.current || 1;
  for (let i = 0; i < pageSize; i++) {
    let realIndex = i + (current - 1) * pageSize;
    let tem = {
      id: realIndex,
      name: "åå­—" + realIndex,
      age: i,
      city: "åŸå¸‚" + realIndex
    };
    if (tem.name.indexOf(name) > -1) {
      res.push(tem);
    }
  }
  return { data: res, ...pagination, total };
}
export default {
  "POST /api/getProductData": (req, res) => {
    //æœç´¢
    res.send({
      status: "ok",
      ...searchProductData(req.body)
    });
  }
};
```



